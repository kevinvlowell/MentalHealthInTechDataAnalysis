---
title: "Nanna_Analysis"
author: "Nanna Katrin"
date: "06/05/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(modelr)
library(ggplot2)
library(gridExtra)

```

## Combined

```{r combined}

dat_agelm <- combined_all %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))

dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)

dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)

age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)

grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")

dat_agelm %>%  ggplot(aes(x = age)) + geom_point(aes(y = bad_conseq)) + geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
  labs(y = "Bad consequences of discussing mental health? (1/0)")


```

## Just 2016 


```{r 2016}
  
dat_agelm <- data2016_recode_rearrange %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))

dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)

dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)

age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)

grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")

dat_agelm %>%  ggplot(aes(x = age)) + geom_point(aes(y = bad_conseq)) + geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
  labs(y = "Bad consequences of discussing mental health? (1/0)")


```




## Just 2018

```{r 2018}

dat_agelm <- data2018_recode %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))

dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)

dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)

age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)

grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")

dat_agelm %>%  ggplot(aes(x = age)) + geom_point(aes(y = bad_conseq)) + geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
  labs(y = "Bad consequences of discussing mental health? (1/0)")


```
## All together


```{r allinone}

##2018
dat_agelm <- data2018_recode %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))

dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)

dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)

age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)

grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")

p18 <- dat_agelm %>%  ggplot(aes(x = age)) + geom_point(aes(y = bad_conseq)) + geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
  labs(y = "Comfortable? (1/0)",
       title = "2018") + theme(title = element_text(size = 10))

##2016
dat_agelm <- data2016_recode_rearrange %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))

dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)

dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)

age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)

grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")

p16 <- dat_agelm %>%  ggplot(aes(x = age)) + geom_point(aes(y = bad_conseq)) + geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
  labs(y = "Comfortable? (1/0)",
       title = "2016" ) + theme(title = element_text(size = 10))

##Both 2016 and 2018
dat_agelm <- combined_all %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))

dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)

dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)

age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)

grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")

pboth <- dat_agelm %>%  ggplot(aes(x = age)) + geom_point(aes(y = bad_conseq)) + geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
  labs(y = "Comfortable? (1/0)",
       title = "Both 2016 and 2018") + theme(title = element_text(size = 10))


grid.arrange(
  arrangeGrob(p16,p18, ncol=2),
  pboth,
  top = "\nComfort (0-1) in discussing mental health with supervisors as a function of age\n
  Difference across years\n"
  )

```

## Stigma Score model

```{r}

stigma_agelm <- combined_all %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))



age_model <- lm(bad_conseq ~ age, data = stigma_agelm)
grid <- stigma_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")





```




