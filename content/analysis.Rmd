---
title: Analysis
description:
toc: true
featuredVideo:  
featuredImage: images/Charlotte-Edey-stairs.jpg
draft: false
---

Image credit: [Charlotte Edey](https://www.charlotteedey.com/)

This comes from the file `content/analysis.Rmd`.

We describe here our detailed data analysis. 

-------

NOTE: Your DA can be broken up into multiple pages if that helps with your organization.

* Introduce what motivates your DA
  * Which variables and relationships are you most interested in?
  * What questions are you interested in answering?
  
* Breadth of the DA
  * Make sure that you ask enough initial questions to explore the different variables in your data.
  
```{r}
# library(tidyverse)
# 
# ## Demographics and Exploration of Mental Health Issue Prevalence
# 
# #generate age demographics per year
# 
# combined_demographic_data %>%
#   filter(!is.na(age)) %>%
#   ggplot() +
#   geom_histogram(aes(x = age), binwidth = 5) +
#   facet_wrap(~year) +
#   xlim(0, 90) +
#   labs(title = "Ages of Total Respondents per Year") +
#   theme(plot.title = element_text(hjust = 0.5)) +
#   xlab("Age") +
#   ylab("Count")
# 
# #generate gender demographics per group year
# 
# combined_demographic_data %>%
#   filter(!is.na(age), !is.na(gender)) %>%
#   ggplot() +
#   geom_histogram(aes(x = age, fill = gender), binwidth = 5) +
#   facet_grid(gender~ year, scales = "free") +
#   xlim(0, 90) +
#   labs(title = "Age Distributions per Gender Identity per Year", fill = "Gender Identity") +
#   theme(plot.title = element_text(hjust = 0.5)) +
#   xlab("Age") +
#   ylab("Count")
# 
# 
# #summarize metrics surrounding mental health issue prevalence
# 
# data2016_demographics %>%
#   filter(!is.na(had_mhd_past)) %>%
#   group_by(year, had_mhd_past) %>%
#   summarize(Count = n()) %>%
#   mutate(Percentage = Count/sum(Count))
# 
# data2016_demographics %>%
#   filter(!is.na(has_mhd_now)) %>%
#   group_by(year, has_mhd_now) %>%
#   summarize(Count = n()) %>%
#   mutate(Percentage = Count/sum(Count))
# 
# data2018_demographics %>%
#   filter(!is.na(had_mhd_past)) %>%
#   group_by(year, had_mhd_past) %>%
#   summarize(Count = n()) %>%
#   mutate(Percentage = Count/sum(Count))
# 
# data2018_demographics %>%
#   filter(!is.na(has_mhd_now)) %>%
#   group_by(year, has_mhd_now) %>%
#   summarize(Count = n()) %>%
#   mutate(Percentage = Count/sum(Count))
# 
# ## how has stigma changed over time
# 
# copy_combined_data <- combined_data
# 
# #quantify measures of stigma
# copy_combinedData$difficulty_asking_for_mh_related_medical_leave <- 
#   recode(copy_combinedData$difficulty_asking_for_mh_related_medical_leave,
#          "Very easy" = 1, 
#          "Somewhat easy" = 2,
#          "Neither easy or difficult" = 3,
#          "Somewhat difficult" = 4,
#          "Very difficult" = 5)
# 
# copy_combinedData$comfortable_discussing_mh_with_coworkers <- 
#   recode(copy_combinedData$comfortable_discussing_mh_with_coworkers,
#          "Yes" = 1, 
#          "Maybe" = 2,
#          "No" = 3)
# 
# copy_combinedData$comfortable_discussing_mh_with_supervisors <- 
#   recode(copy_combinedData$comfortable_discussing_mh_with_supervisors,
#          "Yes" = 1, 
#          "Maybe" = 2,
#          "No" = 3)
# 
# copy_combinedData$willing_to_bring_up_mh_in_interview_y_n <- 
#   recode(copy_combinedData$willing_to_bring_up_mh_in_interview_y_n,
#          "Yes" = 1, 
#          "Maybe" = 2,
#          "No" = 3)<p>&nbsp;</p>
# 
# #generate total "stigma score" per person by summing quantified measures of 
# #stigma, and plot distribution of scores per gender per year
# 
# copy_combinedData %>% 
#   filter(!is.na(gender), !is.na(difficulty_asking_for_mh_related_medical_leave),
#          !is.na(comfortable_discussing_mh_with_coworkers),
#          !is.na(comfortable_discussing_mh_with_supervisors),
#          !is.na(willing_to_bring_up_mh_in_interview_y_n)) %>% 
#   mutate(stigma_score = difficulty_asking_for_mh_related_medical_leave +
#                                comfortable_discussing_mh_with_coworkers +
#                                comfortable_discussing_mh_with_supervisors +
#                                willing_to_bring_up_mh_in_interview_y_n) %>% 
#   ggplot() +
#   geom_histogram(aes(x = stigma_score, fill = gender), binwidth = 1) +
#   facet_grid(gender~ year, scales = "free")
# 
# #compare averages of stigma scores per year and gender
# copy_combinedData %>% 
#   filter(!is.na(gender), !is.na(difficulty_asking_for_mh_related_medical_leave),
#          !is.na(comfortable_discussing_mh_with_coworkers),
#          !is.na(comfortable_discussing_mh_with_supervisors),
#          !is.na(willing_to_bring_up_mh_in_interview_y_n)) %>% 
#   mutate(stigma_score = difficulty_asking_for_mh_related_medical_leave +
#                                comfortable_discussing_mh_with_coworkers +
#                                comfortable_discussing_mh_with_supervisors +
#                                willing_to_bring_up_mh_in_interview_y_n) %>% 
#   group_by(year, gender) %>% 
#   summarize(Average_stigma_score = mean(stigma_score))
```
  
Country of work
```{r country}
# whereFrom2016 <- combined_demographic_data %>% filter(year=="2016") %>% group_by(country_of_work) %>% count() %>% arrange(desc(n)) %>% head(n, n = 10) 
# knitr::kable(whereFrom2016)
# 
# whereFrom2018 <- combined_demographic_data %>% filter(year=="2018") %>% group_by(country_of_residence) %>% count() %>% arrange(desc(n)) %>% head(n, n = 10) 
# knitr::kable(whereFrom2018)
```  
| Rank | Country of work (2016) | Count | &nbsp; | Country of work (2018) | Count |
| --- | --- | ----------- | -- | --- | ----------- |
| 1 | USA | 851 | &nbsp; | USA | 312 | 
| 2 | UK | 185 | &nbsp; | UK | 19 | 
| 3 | Canada | 74 | &nbsp; | Canada | 8 | 
| 4 | Germany | 58 | &nbsp; | Germany | 7 | 
| 5 | Netherlands | 47 | &nbsp; | Poland | 6 | 
| 6 | Australia | 34 | &nbsp; | India | 5 | 
| 7 | Sweden | 20 | &nbsp; | Netherlands | 5 | 
| 8 | Ireland | 15 | &nbsp; | Australia | 4 | 
| 9 | France | 14 | &nbsp; | France | 4 | 
| 10 | Brazil | 10 | &nbsp; | Italy | 4 | 
  
Age and gender 
```{r age-gender}
# age <- combined_demographic_data %>% filter(!is.na(gender)) %>% group_by(gender,year) %>% summarise(n = n()) %>% mutate(freq = n / sum(n)) %>% ungroup
# knitr::kable(age)
# 
# ggplot(age, aes(x=gender, y=n, fill=year)) + geom_bar(stat='identity', position="dodge") + labs(x="Gender", y="Count") + scale_x_discrete(labels=c("Female","Queer/Undefined","Male"))
```
  

Age vs stigma
```{r age-stigma}
####Check for relationship between: "Would you be comfortable discussing mental health with your supervisor?" and age
# ##2018 model
# dat_agelm <- data2018_recode %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))
# 
# dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)
# 
# dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)
# 
# age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)
# 
# grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")
# 
# p18 <- dat_agelm %>%  ggplot(aes(x = age)) + 
#   geom_point(aes(y = bad_conseq), alpha = 0.5) + 
#   geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
#   labs(y = "Comfortable? (1/0)",
#        title = "2018") + theme(title = element_text(size = 10))+
#   theme_minimal()
# ##2016 model
# dat_agelm <- data2016_recode_rearrange %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))
# 
# dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)
# 
# dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)
# 
# age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)
# 
# grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")
# 
# p16 <- dat_agelm %>%  ggplot(aes(x = age)) + 
#   geom_point(aes(y = bad_conseq), alpha = 0.5) + 
#   geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
#   labs(y = "Comfortable? (1/0)",
#        title = "2016" ) + theme(title = element_text(size = 10))+
#   theme_minimal()
# ##Both 2016 and 2018 model
# dat_agelm <- combined_all %>% filter(age >=18 & age < 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))
# 
# dat_agelm$bad_conseq <- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == "Yes" | dat_agelm$comfortable_discussing_mh_with_supervisors == "Maybe", 1, 0)
# 
# dat_agelm <- dat_agelm %>% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)
# 
# age_model <- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)
# 
# grid <- dat_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")
# 
# pboth <- dat_agelm %>%  ggplot(aes(x = age)) + 
#   geom_point(aes(y = bad_conseq), alpha = 0.5) + 
#   geom_line(aes(y=pred), data = grid, color = "red", size = 1) +
#   labs(y = "Comfortable? (1/0)",
#        title = "Both 2016 and 2018") + theme(title = element_text(size = 10))+
#   theme_minimal()
# 
# png("comfortable_talking_to_supervisors_vs_age.png", width = 700, height = 500)
# 
# plot <- grid.arrange(
#   arrangeGrob(p16,p18, ncol=2),
#   pboth,
#   top = "\nComfort (0-1) in discussing mental health with supervisors as a function of age\n
#   Difference across years\n"
#   )
# 
# print(plot)
# dev.off()
####Check forelationship between stigma score and age?
# stigma_agelm <- copy_combinedData %>% filter(age >=18 & age < 80)
# 
# age_model <- lm(stigma_score ~ age, data = stigma_agelm)
# 
# grid <- stigma_agelm %>% data_grid(age) %>% add_predictions(age_model, type = "response")
# 
# png("stigma_vs_age.png", width = 700, height = 500)
# 
# stigma_plot <- stigma_agelm %>% ggplot(aes(x = age)) +
#   geom_point(aes(y = stigma_score), position = "jitter", alpha = 0.5, color = "coral") + 
#   geom_line(aes(y=pred), data = grid, color = "black") + 
#   theme_minimal()+
#   labs(title = "Relationship between Stigma Score and Age",
#        y = "Stigma Score",
#        x = "Age")+ theme(plot.title = element_text(hjust = 0.5))
# 
# print(stigma_plot)
# dev.off()
```

Function converting likert scale responses to numeric so it is easier to model
```{r convertnum}
# convert_str <- function (sub_string) {
#   if (sub_string == 'Yes')
#     {str_num <- 1}
#   else if (sub_string == 'No')
#     {str_num <- 0}
#   else if (sub_string == 'Possibly')
#     {str_num <- 0.33}
#   else if (sub_string == 'Maybe')
#     {str_num <- 0.67}
#   else
#     {str_num <- -1}
#   return(str_num)
# }
# 
# combined_data$num_had_mhd_past <- numeric()
# combined_data$num_has_mhd_now <- numeric()
# combined_data$num_family_history_of_mhd <- numeric()
# for (i in 1:length(combined_data$had_mhd_past)) 
# {
#   combined_data$num_had_mhd_past[i] <- convert_str(combined_data$had_mhd_past[i])
#   combined_data$num_has_mhd_now[i] <- convert_str(combined_data$has_mhd_now[i])
#   combined_data$num_family_history_of_mhd[i] <- convert_str(combined_data$family_history_of_mhd[i])
# }
```

Linear regression prediciting mental health disorder by family history
```{r famhist}
# library(ggplot2)
# library(reshape2)
# 
# # filter data for respondents who reported (1) yes family history of mhd or (0) no history
# famhist <- combined_data %>% filter(!(num_family_history_of_mhd==-1))
# 
# # fit linear model
# model = lm(num_family_history_of_mhd ~num_has_mhd_now, famhist)
# mt_coef = coef(model)
# 
# ggplot(famhist, aes(x= num_has_mhd_now, y= num_family_history_of_mhd)) + geom_jitter(aes(colour=year),alpha = .3) +
#   geom_abline(intercept = mt_coef[1], slope = mt_coef[2], color = "red", size = 1) + 
#          labs(x='Family history of mental health disorder',y='Do you have a mental health disorder now?') + 
#          scale_x_continuous(breaks=c(0,0.5,1),labels=c( "No","Maybe","Yes"), limits=c(-0.2,1.2)) +
#          scale_y_continuous(breaks=c(0,0.5,1),labels=c( "No","Maybe","Yes"), limits=c(-0.2,1.2))
# 
# modelSummary <- summary(model)

```
We use linear regression to model the relationship between a family history of mental health and mental health disorder: 
$$
Has\;mental\;health\;disorder = 0.238 + 0.589(family\;history\;of\;mental\;health\;disorder)
$$ 
A scatter plot of these two variables indicates a possible linear relationship, which was further tested with the regression model. The model was significant (p-value of 2.2e-16), with an r-squared of 0.283, which indicates  that 28.3% of the variation in having a mental health disorder may be explained by a family history of mental health disorder. The positive coefficients indicate a positive relationship between family and self mental health. 

<p>&nbsp;</p>

  * i.e. Do you explore more than just one or two variables? Do you explore a few different relationships or many?
  
  
* Depth of the DA
  * When you answer one question, usually more questions arise as well. 
  * The depth of the DA is about coming up with and exploring the answers to these questions, often iterating the process a few times.
  
  
* Modeling and Inference 
  * You should also include some kind of formal statistical model and/or inference. This could be a linear regression, logistic regression, hypothesis testing etc.
  * Explain the techniques you used for validating your results.
  * Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.
  
  
* Clarity Figures
  * Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?
  * Each figure should provide a key insight. Too many figures or other data summaries can detract from this.
  
  
* Clarity of Explanations
  * Do you introduce why you are doing each analysis?
  * How well do you explain each figure/result?
  * Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?
* Organization and cleanliness.
  * Make sure to remove excessive warnings, use clean easy-to-read code, organize with sections or multiple pages, use bullets, etc.