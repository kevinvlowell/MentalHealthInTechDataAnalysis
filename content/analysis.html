---
title: Analysis
description:
toc: true
featuredVideo:  
featuredImage: images/Charlotte-Edey-stairs.jpg
draft: false
---


<div id="TOC">

</div>

<p>Image credit: <a href="https://www.charlotteedey.com/">Charlotte Edey</a></p>
<p>This comes from the file <code>content/analysis.Rmd</code>.</p>
<p>We describe here our detailed data analysis.</p>
<hr />
<p>Our data analysis focuses on assessing the demographics of tech workers, the prevalence of mental health disorders within this group, and their attitudes and perceptions of mental health in the context of their workspace.</p>
<p>For demographics, we identify several variables of interest:</p>
<ul>
<li>Diversity
<ul>
<li>Age</li>
<li>Gender</li>
</ul></li>
<li>Country of work</li>
</ul>
<p>For mental health, we identify the following variables of interest:</p>
<ul>
<li>Prevalence of mental health disorder, past or present</li>
<li>Stigma associated with mental health, which we calculate from a number survey measures</li>
<li>Family history of mental health</li>
<li>Perceptions of employee attitudes to mental health</li>
<li>Perceptions of employee attitudes to physical health</li>
</ul>
<p>We assess these first univariately, then in relation to each other (for variables we think may interesting to map together, such as age with gender, and perceptions of employee attitudes to mental health with those of physical health). Lastly, we look at the response patterns ond relationships of response patterns over time, made possible by combining survey data from two years, collected in 2016 and 2018.</p>
<pre class="r"><code># library(tidyverse)
# 
# ## Demographics and Exploration of Mental Health Issue Prevalence
# 
# #generate age demographics per year
# 
# combined_demographic_data %&gt;%
#   filter(!is.na(age)) %&gt;%
#   ggplot() +
#   geom_histogram(aes(x = age), binwidth = 5) +
#   facet_wrap(~year) +
#   xlim(0, 90) +
#   labs(title = &quot;Ages of Total Respondents per Year&quot;) +
#   theme(plot.title = element_text(hjust = 0.5)) +
#   xlab(&quot;Age&quot;) +
#   ylab(&quot;Count&quot;)
# 
# #generate gender demographics per group year
# 
# combined_demographic_data %&gt;%
#   filter(!is.na(age), !is.na(gender)) %&gt;%
#   ggplot() +
#   geom_histogram(aes(x = age, fill = gender), binwidth = 5) +
#   facet_grid(gender~ year, scales = &quot;free&quot;) +
#   xlim(0, 90) +
#   labs(title = &quot;Age Distributions per Gender Identity per Year&quot;, fill = &quot;Gender Identity&quot;) +
#   theme(plot.title = element_text(hjust = 0.5)) +
#   xlab(&quot;Age&quot;) +
#   ylab(&quot;Count&quot;)
# 
# 
# #summarize metrics surrounding mental health issue prevalence
# 
# data2016_demographics %&gt;%
#   filter(!is.na(had_mhd_past)) %&gt;%
#   group_by(year, had_mhd_past) %&gt;%
#   summarize(Count = n()) %&gt;%
#   mutate(Percentage = Count/sum(Count))
# 
# data2016_demographics %&gt;%
#   filter(!is.na(has_mhd_now)) %&gt;%
#   group_by(year, has_mhd_now) %&gt;%
#   summarize(Count = n()) %&gt;%
#   mutate(Percentage = Count/sum(Count))
# 
# data2018_demographics %&gt;%
#   filter(!is.na(had_mhd_past)) %&gt;%
#   group_by(year, had_mhd_past) %&gt;%
#   summarize(Count = n()) %&gt;%
#   mutate(Percentage = Count/sum(Count))
# 
# data2018_demographics %&gt;%
#   filter(!is.na(has_mhd_now)) %&gt;%
#   group_by(year, has_mhd_now) %&gt;%
#   summarize(Count = n()) %&gt;%
#   mutate(Percentage = Count/sum(Count))
# 
# ## how has stigma changed over time
# 
# copy_combined_data &lt;- combined_data
# 
# #quantify measures of stigma
# copy_combinedData$difficulty_asking_for_mh_related_medical_leave &lt;- 
#   recode(copy_combinedData$difficulty_asking_for_mh_related_medical_leave,
#          &quot;Very easy&quot; = 1, 
#          &quot;Somewhat easy&quot; = 2,
#          &quot;Neither easy or difficult&quot; = 3,
#          &quot;Somewhat difficult&quot; = 4,
#          &quot;Very difficult&quot; = 5)
# 
# copy_combinedData$comfortable_discussing_mh_with_coworkers &lt;- 
#   recode(copy_combinedData$comfortable_discussing_mh_with_coworkers,
#          &quot;Yes&quot; = 1, 
#          &quot;Maybe&quot; = 2,
#          &quot;No&quot; = 3)
# 
# copy_combinedData$comfortable_discussing_mh_with_supervisors &lt;- 
#   recode(copy_combinedData$comfortable_discussing_mh_with_supervisors,
#          &quot;Yes&quot; = 1, 
#          &quot;Maybe&quot; = 2,
#          &quot;No&quot; = 3)
# 
# copy_combinedData$willing_to_bring_up_mh_in_interview_y_n &lt;- 
#   recode(copy_combinedData$willing_to_bring_up_mh_in_interview_y_n,
#          &quot;Yes&quot; = 1, 
#          &quot;Maybe&quot; = 2,
#          &quot;No&quot; = 3)&lt;p&gt;&amp;nbsp;&lt;/p&gt;
# 
# #generate total &quot;stigma score&quot; per person by summing quantified measures of 
# #stigma, and plot distribution of scores per gender per year
# 
# copy_combinedData %&gt;% 
#   filter(!is.na(gender), !is.na(difficulty_asking_for_mh_related_medical_leave),
#          !is.na(comfortable_discussing_mh_with_coworkers),
#          !is.na(comfortable_discussing_mh_with_supervisors),
#          !is.na(willing_to_bring_up_mh_in_interview_y_n)) %&gt;% 
#   mutate(stigma_score = difficulty_asking_for_mh_related_medical_leave +
#                                comfortable_discussing_mh_with_coworkers +
#                                comfortable_discussing_mh_with_supervisors +
#                                willing_to_bring_up_mh_in_interview_y_n) %&gt;% 
#   ggplot() +
#   geom_histogram(aes(x = stigma_score, fill = gender), binwidth = 1) +
#   facet_grid(gender~ year, scales = &quot;free&quot;)
# 
# #compare averages of stigma scores per year and gender
# copy_combinedData %&gt;% 
#   filter(!is.na(gender), !is.na(difficulty_asking_for_mh_related_medical_leave),
#          !is.na(comfortable_discussing_mh_with_coworkers),
#          !is.na(comfortable_discussing_mh_with_supervisors),
#          !is.na(willing_to_bring_up_mh_in_interview_y_n)) %&gt;% 
#   mutate(stigma_score = difficulty_asking_for_mh_related_medical_leave +
#                                comfortable_discussing_mh_with_coworkers +
#                                comfortable_discussing_mh_with_supervisors +
#                                willing_to_bring_up_mh_in_interview_y_n) %&gt;% 
#   group_by(year, gender) %&gt;% 
#   summarize(Average_stigma_score = mean(stigma_score))</code></pre>
<p>Country of work</p>
<pre class="r"><code># whereFrom2016 &lt;- combined_demographic_data %&gt;% filter(year==&quot;2016&quot;) %&gt;% group_by(country_of_work) %&gt;% count() %&gt;% arrange(desc(n)) %&gt;% head(n, n = 10) 
# knitr::kable(whereFrom2016)
# 
# whereFrom2018 &lt;- combined_demographic_data %&gt;% filter(year==&quot;2018&quot;) %&gt;% group_by(country_of_residence) %&gt;% count() %&gt;% arrange(desc(n)) %&gt;% head(n, n = 10) 
# knitr::kable(whereFrom2018)</code></pre>
<table>
<thead>
<tr class="header">
<th>Rank</th>
<th>Country of work (2016)</th>
<th>Count</th>
<th> </th>
<th>Country of work (2018)</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>USA</td>
<td>851</td>
<td> </td>
<td>USA</td>
<td>312</td>
</tr>
<tr class="even">
<td>2</td>
<td>UK</td>
<td>185</td>
<td> </td>
<td>UK</td>
<td>19</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Canada</td>
<td>74</td>
<td> </td>
<td>Canada</td>
<td>8</td>
</tr>
<tr class="even">
<td>4</td>
<td>Germany</td>
<td>58</td>
<td> </td>
<td>Germany</td>
<td>7</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Netherlands</td>
<td>47</td>
<td> </td>
<td>Poland</td>
<td>6</td>
</tr>
<tr class="even">
<td>6</td>
<td>Australia</td>
<td>34</td>
<td> </td>
<td>India</td>
<td>5</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Sweden</td>
<td>20</td>
<td> </td>
<td>Netherlands</td>
<td>5</td>
</tr>
<tr class="even">
<td>8</td>
<td>Ireland</td>
<td>15</td>
<td> </td>
<td>Australia</td>
<td>4</td>
</tr>
<tr class="odd">
<td>9</td>
<td>France</td>
<td>14</td>
<td> </td>
<td>France</td>
<td>4</td>
</tr>
<tr class="even">
<td>10</td>
<td>Brazil</td>
<td>10</td>
<td> </td>
<td>Italy</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>Age and gender</p>
<pre class="r"><code># age &lt;- combined_demographic_data %&gt;% filter(!is.na(gender)) %&gt;% group_by(gender,year) %&gt;% summarise(n = n()) %&gt;% mutate(freq = n / sum(n)) %&gt;% ungroup
# knitr::kable(age)
# 
# ggplot(age, aes(x=gender, y=n, fill=year)) + geom_bar(stat=&#39;identity&#39;, position=&quot;dodge&quot;) + labs(x=&quot;Gender&quot;, y=&quot;Count&quot;) + scale_x_discrete(labels=c(&quot;Female&quot;,&quot;Queer/Undefined&quot;,&quot;Male&quot;))</code></pre>
<p>Age vs stigma</p>
<pre class="r"><code>####Check for relationship between: &quot;Would you be comfortable discussing mental health with your supervisor?&quot; and age
# ##2018 model
# dat_agelm &lt;- data2018_recode %&gt;% filter(age &gt;=18 &amp; age &lt; 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))
# 
# dat_agelm$bad_conseq &lt;- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == &quot;Yes&quot; | dat_agelm$comfortable_discussing_mh_with_supervisors == &quot;Maybe&quot;, 1, 0)
# 
# dat_agelm &lt;- dat_agelm %&gt;% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)
# 
# age_model &lt;- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)
# 
# grid &lt;- dat_agelm %&gt;% data_grid(age) %&gt;% add_predictions(age_model, type = &quot;response&quot;)
# 
# p18 &lt;- dat_agelm %&gt;%  ggplot(aes(x = age)) + 
#   geom_point(aes(y = bad_conseq), alpha = 0.5) + 
#   geom_line(aes(y=pred), data = grid, color = &quot;red&quot;, size = 1) +
#   labs(y = &quot;Comfortable? (1/0)&quot;,
#        title = &quot;2018&quot;) + theme(title = element_text(size = 10))+
#   theme_minimal()
# ##2016 model
# dat_agelm &lt;- data2016_recode_rearrange %&gt;% filter(age &gt;=18 &amp; age &lt; 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))
# 
# dat_agelm$bad_conseq &lt;- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == &quot;Yes&quot; | dat_agelm$comfortable_discussing_mh_with_supervisors == &quot;Maybe&quot;, 1, 0)
# 
# dat_agelm &lt;- dat_agelm %&gt;% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)
# 
# age_model &lt;- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)
# 
# grid &lt;- dat_agelm %&gt;% data_grid(age) %&gt;% add_predictions(age_model, type = &quot;response&quot;)
# 
# p16 &lt;- dat_agelm %&gt;%  ggplot(aes(x = age)) + 
#   geom_point(aes(y = bad_conseq), alpha = 0.5) + 
#   geom_line(aes(y=pred), data = grid, color = &quot;red&quot;, size = 1) +
#   labs(y = &quot;Comfortable? (1/0)&quot;,
#        title = &quot;2016&quot; ) + theme(title = element_text(size = 10))+
#   theme_minimal()
# ##Both 2016 and 2018 model
# dat_agelm &lt;- combined_all %&gt;% filter(age &gt;=18 &amp; age &lt; 80, !(is.na(age)| is.na(comfortable_discussing_mh_with_supervisors)))
# 
# dat_agelm$bad_conseq &lt;- ifelse(dat_agelm$comfortable_discussing_mh_with_supervisors == &quot;Yes&quot; | dat_agelm$comfortable_discussing_mh_with_supervisors == &quot;Maybe&quot;, 1, 0)
# 
# dat_agelm &lt;- dat_agelm %&gt;% select(age, comfortable_discussing_mh_with_supervisors , bad_conseq)
# 
# age_model &lt;- glm(bad_conseq ~ age, data = dat_agelm, family = binomial)
# 
# grid &lt;- dat_agelm %&gt;% data_grid(age) %&gt;% add_predictions(age_model, type = &quot;response&quot;)
# 
# pboth &lt;- dat_agelm %&gt;%  ggplot(aes(x = age)) + 
#   geom_point(aes(y = bad_conseq), alpha = 0.5) + 
#   geom_line(aes(y=pred), data = grid, color = &quot;red&quot;, size = 1) +
#   labs(y = &quot;Comfortable? (1/0)&quot;,
#        title = &quot;Both 2016 and 2018&quot;) + theme(title = element_text(size = 10))+
#   theme_minimal()
# 
# png(&quot;comfortable_talking_to_supervisors_vs_age.png&quot;, width = 700, height = 500)
# 
# plot &lt;- grid.arrange(
#   arrangeGrob(p16,p18, ncol=2),
#   pboth,
#   top = &quot;\nComfort (0-1) in discussing mental health with supervisors as a function of age\n
#   Difference across years\n&quot;
#   )
# 
# print(plot)
# dev.off()
####Check forelationship between stigma score and age?
# stigma_agelm &lt;- copy_combinedData %&gt;% filter(age &gt;=18 &amp; age &lt; 80)
# 
# age_model &lt;- lm(stigma_score ~ age, data = stigma_agelm)
# 
# grid &lt;- stigma_agelm %&gt;% data_grid(age) %&gt;% add_predictions(age_model, type = &quot;response&quot;)
# 
# png(&quot;stigma_vs_age.png&quot;, width = 700, height = 500)
# 
# stigma_plot &lt;- stigma_agelm %&gt;% ggplot(aes(x = age)) +
#   geom_point(aes(y = stigma_score), position = &quot;jitter&quot;, alpha = 0.5, color = &quot;coral&quot;) + 
#   geom_line(aes(y=pred), data = grid, color = &quot;black&quot;) + 
#   theme_minimal()+
#   labs(title = &quot;Relationship between Stigma Score and Age&quot;,
#        y = &quot;Stigma Score&quot;,
#        x = &quot;Age&quot;)+ theme(plot.title = element_text(hjust = 0.5))
# 
# print(stigma_plot)
# dev.off()</code></pre>
<p>Function converting likert scale responses to numeric so it is easier to model</p>
<pre class="r"><code># convert_str &lt;- function (sub_string) {
#   if (sub_string == &#39;Yes&#39;)
#     {str_num &lt;- 1}
#   else if (sub_string == &#39;No&#39;)
#     {str_num &lt;- 0}
#   else if (sub_string == &#39;Possibly&#39;)
#     {str_num &lt;- 0.33}
#   else if (sub_string == &#39;Maybe&#39;)
#     {str_num &lt;- 0.67}
#   else
#     {str_num &lt;- -1}
#   return(str_num)
# }
# 
# combined_data$num_had_mhd_past &lt;- numeric()
# combined_data$num_has_mhd_now &lt;- numeric()
# combined_data$num_family_history_of_mhd &lt;- numeric()
# for (i in 1:length(combined_data$had_mhd_past)) 
# {
#   combined_data$num_had_mhd_past[i] &lt;- convert_str(combined_data$had_mhd_past[i])
#   combined_data$num_has_mhd_now[i] &lt;- convert_str(combined_data$has_mhd_now[i])
#   combined_data$num_family_history_of_mhd[i] &lt;- convert_str(combined_data$family_history_of_mhd[i])
# }</code></pre>
<p>Linear regression prediciting mental health disorder by family history</p>
<pre class="r"><code># library(ggplot2)
# library(reshape2)
# 
# # filter data for respondents who reported (1) yes family history of mhd or (0) no history
# famhist &lt;- combined_data %&gt;% filter(!(num_family_history_of_mhd==-1))
# 
# # fit linear model
# model = lm(num_family_history_of_mhd ~num_has_mhd_now, famhist)
# mt_coef = coef(model)
# 
# ggplot(famhist, aes(x= num_has_mhd_now, y= num_family_history_of_mhd)) + geom_jitter(aes(colour=year),alpha = .3) +
#   geom_abline(intercept = mt_coef[1], slope = mt_coef[2], color = &quot;red&quot;, size = 1) + 
#          labs(x=&#39;Family history of mental health disorder&#39;,y=&#39;Do you have a mental health disorder now?&#39;) + 
#          scale_x_continuous(breaks=c(0,0.5,1),labels=c( &quot;No&quot;,&quot;Maybe&quot;,&quot;Yes&quot;), limits=c(-0.2,1.2)) +
#          scale_y_continuous(breaks=c(0,0.5,1),labels=c( &quot;No&quot;,&quot;Maybe&quot;,&quot;Yes&quot;), limits=c(-0.2,1.2))
# 
# modelSummary &lt;- summary(model)</code></pre>
<p>We use linear regression to model the relationship between having a family history of mental health disorder and having a mental health disorder oneself:
<span class="math display">\[
Has\;mental\;health\;disorder = 0.238 + 0.589(family\;history\;of\;mental\;health\;disorder)
\]</span>
A scatter plot of these two variables indicates a possible linear relationship, which was further tested with the regression model. The model was significant (p-value of 2.2e-16), with an r-squared of 0.283, which indicates that 28.3% of the variation in having a mental health disorder may be explained by a family history of mental health disorder. The positive coefficients indicate a positive relationship between family and self mental health.</p>
<p>
 
</p>
<ul>
<li><p>i.e. Do you explore more than just one or two variables? Do you explore a few different relationships or many?</p></li>
<li>Depth of the DA
<ul>
<li>When you answer one question, usually more questions arise as well.</li>
<li>The depth of the DA is about coming up with and exploring the answers to these questions, often iterating the process a few times.</li>
</ul></li>
<li>Modeling and Inference
<ul>
<li>You should also include some kind of formal statistical model and/or inference. This could be a linear regression, logistic regression, hypothesis testing etc.</li>
<li>Explain the techniques you used for validating your results.</li>
<li>Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.</li>
</ul></li>
<li>Clarity Figures
<ul>
<li>Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?</li>
<li>Each figure should provide a key insight. Too many figures or other data summaries can detract from this.</li>
</ul></li>
<li>Clarity of Explanations
<ul>
<li>Do you introduce why you are doing each analysis?</li>
<li>How well do you explain each figure/result?</li>
<li>Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?</li>
</ul></li>
<li>Organization and cleanliness.
<ul>
<li>Make sure to remove excessive warnings, use clean easy-to-read code, organize with sections or multiple pages, use bullets, etc.</li>
</ul></li>
</ul>
